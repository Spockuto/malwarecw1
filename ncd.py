import os 
import lzma
import matplotlib.pyplot as plt
import numpy as np

def ncd (path1 , path2) :
    file1 = open(path1, "rb").read()
    file2 = open(path2, "rb").read()
    zx = len(lzma.compress(file1,format=lzma.FORMAT_RAW,
        filters=[{'id': lzma.FILTER_LZMA2, 'preset': 9 | lzma.PRESET_EXTREME}]))
    zy = len(lzma.compress(file2, format=lzma.FORMAT_RAW,
        filters=[{'id': lzma.FILTER_LZMA2, 'preset': 9 | lzma.PRESET_EXTREME}]))
    zxy = len(lzma.compress(file1 + file2))
    score = (zxy - min (zx , zy)) / max(zx , zy)
    print("zx: " + str(zx) + " zy: " + str(zy) + " zxy: " + str(zxy) + " score: " + str(score))
    return score

cwd =  os.getcwd()

testFileDir = "g17"
classFileDir = "fileClasses"

testFilePath = [[each, os.path.abspath(testFileDir + "/" + each)] for each in os.listdir(cwd + "/" + testFileDir)]
classFilePath = [[each, os.path.abspath(classFileDir + "/" + each)] for each in os.listdir(cwd + "/" + classFileDir)]
classFilePath.sort()
testFilePath.sort()
totalPath  = classFilePath + testFilePath 
names = [each[0] for each in totalPath]
matrixSize = len(classFilePath) + len (testFilePath)
plot = np.zeros((matrixSize, matrixSize))

classification = []
for i, file1 in enumerate(totalPath) :
    score, index = 9999 , 0
    for j, file2 in enumerate(totalPath) :
        plot[i][j] =  ncd(file1[1], file2[1])
        if plot[i][j] < score and j < 8 :
            score = plot[i][j]
            index = j + 1
    classification.append([file1[0], index])    
print(classification)

plt.matshow(plot, cmap=plt.get_cmap('gray'))
plt.title("Similarity Matrix")
plt.colorbar()
plt.show()


'''
argument = []
for file1 in (totalPath) :
    argument.append(ncd(file1[1], file1[1]))

fig, (ax1, ax2) = plt.subplots(1, 2)
fig.suptitle('NCD(x,x) for given dataset')
ax1.set_ylim(-0.5, 1)
ax1.set_xlim(0,27)
ax1.plot(argument)
ax2.set_ylim(-0.005, 0.005)
ax2.set_xlim(0,27)
ax2.plot(argument)
plt.show()


plt.plot(argument)
plt.ylim((-0.1, 0.1))
plt.title("NCD(x,x) for given dataset")
plt.show()
'''